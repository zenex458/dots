#!/usr/bin/env bash

isservice=$(systemctl --user is-enabled mpd.service)
moudir="/home/zenex/Music"

if [ "$isservice" == "linked" ]; then
    mpdstartcmd="systemctl --user restart mpd.service"
    mpdkillcmd="systemctl --user stop mpd.service"
else
    mpdstartcmd="mpd"
    mpdkillcmd="mpd --kill"
fi

mu() {
	dirs=$(find "$moudir" -maxdepth 1 2>/dev/null | wc -l)
	if [ "$dirs" -eq 5 ] || [ "$dirs" -eq 1 ] ; then
		printf '%s\n%s\n' "SD Card not mounted." "Mounting...."
		sudo mount -m -v -o rw,noexec,uid=1000,gid=1000 UUID=3961-3035 "$moudir"
		echo "Starting mpd and ncmpcpp"
	fi
	$mpdstartcmd
  # kitty -T ncmpcpp ncmpcpp >/dev/null &
  footclient -T ncmpcpp ncmpcpp >/dev/null &
}

_help() {
	printf "Usage:\n mu [OPTION]\n
Options:
 -r\t Unmount and kill mpd and print lsblk for verification
 -h\t Show this help message.\n"
}

if [ -z "$1" ]; then
	mu
elif [ "$1" = "-r" ]; then
  pkill ncmpcpp
	mpc pause >/dev/null
 $mpdkillcmd 2>/dev/null
 sudo umount -v "$moudir"
else
	_help
fi
